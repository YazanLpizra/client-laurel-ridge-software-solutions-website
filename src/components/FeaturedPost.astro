---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import { formatDate } from "@utils/utils.ts";

// Gets English posts by tag
const featuredPosts = await getCollection("blog", ({ id, data }) => {
    return id.startsWith("en/") && data.tags.includes("featured");
});
---

<div class="blog-sidebar">
    <div class="blog-featured-group">
        <span class="blog-header">Featured Posts</span>
        {featuredPosts.length === 0 && <h2>No Featured Posts</h2>}
        {
            featuredPosts.map((post) => (
                <a
                    class="blog-feature"
                    href={`/blog/${post.id.split("/")[1]?.replace(".md", "") ?? ""}`}
                >
                    <picture class="blog-featureImage">
                        <Image
                            src={post.data.image}
                            alt={post.data.imageAlt}
                            width="60"
                            height="60"
                            decoding="async"
                        />
                    </picture>
                    <div class="content-group">
                        <h3 class="feature-h3">{post.data.title}</h3>
                        <span class="feature-date">
                            {formatDate(post.data.date)}
                        </span>
                    </div>
                </a>
            ))
        }
    </div>
</div>

<style lang="scss">
    /* Mobile - 360px */
    @media only screen and (min-width: 0em) {
        .blog-sidebar {
            width: 100%;
            max-width: calc(795 / 16 * 1em);
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            row-gap: calc(50 / 16 * 1em);

            .blog-featured-group {
                width: 100%;
                padding: calc(35 / 16 * 1em) calc(30 / 16 * 1em);
                border: 1px solid #ebebeb;
                border-radius: calc(8 / 16 * 1em);
                display: flex;
                flex-direction: column;
                justify-content: flex-start;
                align-items: center;
            }

            .blog-header {
                font-size: calc(20 / 16 * 1em);
                font-weight: bold;
                text-align: center;
                margin-bottom: calc(30 / 16 * 1rem);
                color: var(--headerColor);
                display: block;
                position: relative;

                &:after {
                    content: "";
                    width: calc(50 / 16 * 1rem);
                    height: 3px;
                    margin: calc(16 / 16 * 1rem) auto;
                    background: var(--headerColor);
                    border-radius: calc(4 / 16 * 1rem);
                    display: block;
                    position: relative;
                }
            }

            .blog-feature {
                text-decoration: none;
                width: 100%;
                padding: calc(20 / 16 * 1rem) 0;
                border-bottom: 1px solid #ebebeb;
                display: flex;
                justify-content: flex-start;
                align-items: center;
                column-gap: calc(24 / 16 * 1em);

                &:nth-of-type(1) {
                    padding-top: 0;
                }

                &:last-of-type {
                    padding-bottom: 0;
                    border: none;
                }
            }

            .blog-featureImage {
                width: calc(60 / 16 * 1em);
                height: calc(60 / 16 * 1em);
                border-radius: 50%;
                display: block;
                position: relative;
                overflow: hidden;
                flex: none;

                img {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                    position: absolute;
                    top: 0;
                    left: 0;
                }
            }

            .feature-h3 {
                font-size: calc(15 / 16 * 1rem);
                font-weight: 700;
                line-height: 1.5em;
                text-decoration: none;
                margin: 0;
                margin-bottom: calc(4 / 16 * 1rem);
                color: var(--headerColor);
                display: block;
            }

            .feature-date {
                font-size: calc(14 / 16 * 1rem);
                line-height: 1.5em;
                color: var(--bodyTextColor);
                display: block;
            }
        }
    }

    /* Tablet - 1024px */
    @media only screen and (min-width: 64em) {
        .blog-sidebar {
            max-width: calc(360 / 16 * 1em);
        }
    }

    /* Dark Mode */
    @media only screen and (min-width: 0em) {
        body.dark-mode {
            .blog-sidebar {
                .feature-h3,
                .feature-date,
                .blog-header {
                    color: #f7f7f7;
                }
                .blog-header {
                    &:after {
                        background: var(--primary);
                    }
                }
            }
        }
    }
</style>
